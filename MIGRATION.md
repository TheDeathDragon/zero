# è¿ç§»è¯´æ˜Ž: Contentlayer â†’ GitHub API + next-mdx-remote

## ðŸ“ æ¦‚è¿°

æœ¬é¡¹ç›®å·²ä»Ž **Contentlayer** è¿ç§»åˆ° **GitHub API + next-mdx-remote** æ–¹æ¡ˆï¼Œä»¥è§£å†³ Contentlayer åœæ­¢ç»´æŠ¤çš„é—®é¢˜ï¼Œå¹¶æä¾›æ›´çŽ°ä»£åŒ–çš„å†…å®¹ç®¡ç†æ–¹å¼ã€‚

---

## âœ… ä¸»è¦æ”¹åŠ¨

### æ–°å¢žæ–‡ä»¶
- `lib/github.ts` - GitHub API æœåŠ¡å±‚
- `lib/mdx.ts` - MDX å¤„ç†å·¥å…·
- `components/PostList.tsx` - æ–‡ç« åˆ—è¡¨å®¢æˆ·ç«¯ç»„ä»¶
- `components/InspirationList.tsx` - çµæ„Ÿåˆ—è¡¨å®¢æˆ·ç«¯ç»„ä»¶
- `.env.example` - çŽ¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹

### åˆ é™¤æ–‡ä»¶
- `contentlayer.config.ts`
- `utils/rehypeImageSizes.ts`
- `components/MDX/index.tsx`

### ä¾èµ–å˜æ›´
**ç§»é™¤:**
- contentlayer2
- next-contentlayer2
- mdx-bundler

**æ–°å¢ž:**
- next-mdx-remote
- gray-matter

---

## ðŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜ç­–ç•¥
- **GitHub API**: ç¼“å­˜ 1 å°æ—¶ï¼ˆ3600ç§’ï¼‰
- **é¡µé¢é‡æ–°éªŒè¯**: 1 å°æ—¶
- **æœåŠ¡ç«¯ç¼“å­˜**: ä½¿ç”¨ `unstable_cache` ç¼“å­˜æ–‡ç« æ•°æ®

### 2. æŒ‰éœ€ç¼–è¯‘
- **åˆ—è¡¨é¡µ**: åªæ˜¾ç¤ºçº¯æ–‡æœ¬æ‘˜è¦ï¼Œä¸ç¼–è¯‘ MDX
- **è¯¦æƒ…é¡µ**: æŒ‰éœ€ç¼–è¯‘å®Œæ•´ MDX å†…å®¹
- **çµæ„Ÿé¡µ**: çº¯æ–‡æœ¬æ˜¾ç¤ºï¼Œä¸é¢„ç¼–è¯‘

### 3. å¹¶è¡Œå¤„ç†
- æ‰€æœ‰æ–‡ç« å¹¶è¡ŒèŽ·å–å’Œè§£æž
- æ˜¾è‘—æå‡é¦–æ¬¡åŠ è½½é€Ÿåº¦

---

## ðŸ”§ éƒ¨ç½²é…ç½®

### çŽ¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰

åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

```bash
# å¯é€‰ï¼šæé«˜ GitHub API é€ŸçŽ‡é™åˆ¶
GITHUB_TOKEN=your_github_personal_access_token
```

**èŽ·å– GitHub Token:**
1. GitHub Settings â†’ Developer settings â†’ Personal access tokens
2. Generate new token (classic)
3. åªéœ€è¦ `public_repo` æƒé™

**é€ŸçŽ‡é™åˆ¶:**
- æ—  token: 60 æ¬¡/å°æ—¶
- æœ‰ token: 5000 æ¬¡/å°æ—¶

### æŽ¨èéƒ¨ç½²å¹³å°
- âœ… Vercel (æŽ¨è)
- âœ… Netlify
- âœ… Cloudflare Pages

---

## ðŸ“Š æ•°æ®æµç¨‹

```
GitHub ä»“åº“ (TheDeathDragon/blog)
    â†“
GitHub Raw Content API
    â†“
Next.js æœåŠ¡å™¨ (ç¼“å­˜ 1å°æ—¶)
    â†“
gray-matter (è§£æž frontmatter)
    â†“
next-mdx-remote (ç¼–è¯‘ MDX)
    â†“
React ç»„ä»¶
    â†“
ç”¨æˆ·æµè§ˆå™¨
```

---

## ðŸ”„ ç¼“å­˜æœºåˆ¶

### ä¸‰çº§ç¼“å­˜
1. **Fetch ç¼“å­˜**: `next.revalidate = 3600`
2. **æœåŠ¡ç«¯ç¼“å­˜**: `unstable_cache`
3. **é¡µé¢ç¼“å­˜**: `export const revalidate = 3600`

### ç¼“å­˜åˆ·æ–°
- è‡ªåŠ¨: æ¯å°æ—¶é‡æ–°éªŒè¯
- æ‰‹åŠ¨: é‡æ–°éƒ¨ç½²åº”ç”¨

---

## âš ï¸ å·²çŸ¥é—®é¢˜ä¸Žè§£å†³æ–¹æ¡ˆ

### 1. Serverless Function è¶…æ—¶
**é—®é¢˜:** é¦–æ¬¡è®¿é—®æ—¶å¯èƒ½è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ:**
- âœ… ä½¿ç”¨å¹¶è¡Œå¤„ç†
- âœ… å¢žåŠ ç¼“å­˜æ—¶é—´
- âœ… æŒ‰éœ€ç¼–è¯‘ MDX
- âœ… ä½¿ç”¨ `unstable_cache`

### 2. æž„å»ºçŽ¯å¢ƒæ— ç½‘ç»œ
**é—®é¢˜:** æŸäº› CI/CD çŽ¯å¢ƒå¯èƒ½æ— æ³•è®¿é—® GitHub API

**è§£å†³æ–¹æ¡ˆ:**
- âœ… é¡µé¢æ”¹ä¸ºåŠ¨æ€æ¸²æŸ“ï¼ˆISRï¼‰
- âœ… ä¸åœ¨æž„å»ºæ—¶é¢„æ¸²æŸ“æ‰€æœ‰é¡µé¢
- âœ… éƒ¨ç½²åŽé¦–æ¬¡è®¿é—®æ—¶ç”Ÿæˆ

### 3. Google Fonts åŠ è½½å¤±è´¥
**é—®é¢˜:** æŸäº›çŽ¯å¢ƒæ— æ³•è®¿é—® Google Fonts

**è§£å†³æ–¹æ¡ˆ:**
- âœ… å·²åœ¨ `app/layout.tsx` ä¸­æ³¨é‡ŠæŽ‰
- ðŸ”§ å¯é€‰: ä½¿ç”¨æœ¬åœ°å­—ä½“æˆ–å…¶ä»– CDN

---

## ðŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | Contentlayer | GitHub API |
|------|--------------|------------|
| æž„å»ºæ—¶é—´ | ~30ç§’ | ~15ç§’ (è·³è¿‡é¢„æ¸²æŸ“) |
| éƒ¨ç½²å¤§å° | ~50MB (å«æ–‡ç« ) | ~10MB (ä¸å«æ–‡ç« ) |
| é¦–æ¬¡åŠ è½½ | å¿« (é¢„ç¼–è¯‘) | ä¸­ç­‰ (æŒ‰éœ€ç¼–è¯‘) |
| åŽç»­åŠ è½½ | å¿« | å¿« (ç¼“å­˜) |
| å†…å®¹æ›´æ–° | éœ€è¦é‡æ–°æž„å»º | è‡ªåŠ¨ (1å°æ—¶) |
| API è°ƒç”¨ | 0 | æŒ‰éœ€ï¼ˆæœ‰ç¼“å­˜ï¼‰ |

---

## ðŸ› ï¸ å¼€å‘æŒ‡å—

### æœ¬åœ°å¼€å‘

```bash
# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼
npm run dev

# æž„å»º
npm run build

# ç”Ÿäº§æ¨¡å¼
npm start
```

### è°ƒæ•´ç¼“å­˜æ—¶é—´

ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ä¸­çš„ `revalidate` å€¼ï¼š

- `lib/github.ts` (GitHub API ç¼“å­˜)
- `lib/mdx.ts` (æ–‡ç« æ•°æ®ç¼“å­˜)
- `app/page.tsx`, `app/posts/[slug]/page.tsx` ç­‰ (é¡µé¢ç¼“å­˜)

---

## ðŸ“ åŽç»­ä¼˜åŒ–å»ºè®®

1. **æ·»åŠ  GitHub Token** - æé«˜ API é™åˆ¶
2. **å®žçŽ° Webhook** - å®žæ—¶æ›´æ–°å†…å®¹
3. **æ·»åŠ æœç´¢åŠŸèƒ½** - ä½¿ç”¨ Algolia æˆ–æœ¬åœ°æœç´¢
4. **å›¾ç‰‡ä¼˜åŒ–** - ä½¿ç”¨ Next.js Image ä¼˜åŒ–
5. **RSS Feed** - ç”Ÿæˆ RSS è®¢é˜…æº

---

## ðŸ› æ•…éšœæŽ’æŸ¥

### Serverless Function è¶…æ—¶
- æ£€æŸ¥ `revalidate` è®¾ç½®
- ç¡®è®¤ä½¿ç”¨äº† `unstable_cache`
- éªŒè¯å¹¶è¡Œå¤„ç†æ˜¯å¦ç”Ÿæ•ˆ

### API é€ŸçŽ‡é™åˆ¶
- æ·»åŠ  `GITHUB_TOKEN` çŽ¯å¢ƒå˜é‡
- å¢žåŠ ç¼“å­˜æ—¶é—´
- æ£€æŸ¥ç¼“å­˜æ˜¯å¦ç”Ÿæ•ˆ

### å†…å®¹ä¸æ›´æ–°
- ç­‰å¾…ç¼“å­˜è¿‡æœŸï¼ˆ1å°æ—¶ï¼‰
- æ‰‹åŠ¨é‡æ–°éƒ¨ç½²
- æ¸…é™¤ Vercel ç¼“å­˜

---

## ðŸ“ž æŠ€æœ¯æ”¯æŒ

- GitHub Issues: [TheDeathDragon/zero](https://github.com/TheDeathDragon/zero/issues)
- Next.js æ–‡æ¡£: https://nextjs.org/docs
- next-mdx-remote: https://github.com/hashicorp/next-mdx-remote

---

**è¿ç§»å®Œæˆæ—¶é—´:** 2025-11-14
**Next.js ç‰ˆæœ¬:** 14.2.33
**Node.js è¦æ±‚:** >= 18.0.0
